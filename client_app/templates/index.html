<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Клиенты</title>
</head>
<body>
    <h1>Добавить клиента</h1>
    <form id="clientForm">
        <label>Имя: <input type="text" name="name" required></label><br>
        <label>Телефон: <input type="text" name="phone" required></label><br>
        <label>Город: <input type="text" name="city" required></label><br>
        <label>Интерес: <input type="text" name="interest" required></label><br>
        <button type="submit">Добавить</button>
    </form>

    <h2>Список клиентов</h2>
    <table border="1" id="clientsTable">
        <thead>
            <tr>
                <th>ID</th><th>Имя</th><th>Телефон</th><th>Город</th><th>Интерес</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const form = document.getElementById('clientForm');
        const tableBody = document.querySelector('#clientsTable tbody');

        async function loadClients() {
            const res = await fetch('/clients/');
            const clients = await res.json();
            tableBody.innerHTML = '';
            clients.forEach(c => {
                const row = `<tr>
                    <td>${c.id}</td>
                    <td>${c.name}</td>
                    <td>${c.phone}</td>
                    <td>${c.city}</td>
                    <td>${c.interest}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(form));
            await fetch('/clients/', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify(data)
            });
            form.reset();
            loadClients();
        });

        loadClients();
    </script>
<button id="exportBtn">Экспорт в Excel</button>

<script>
    const exportBtn = document.getElementById('exportBtn');
    exportBtn.addEventListener('click', () => {
        window.location.href = '/export/';
    });
</script>

</body>
</html>
